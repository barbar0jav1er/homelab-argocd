global:
  deploymentAnnotations:
    secret.reloader.stakater.com/reload: "authentik"

# Authentik configuration  
authentik:
  enabled: false  # We'll use external secret with envFrom

server:
  envFrom:
  - secretRef:
      name: authentik
  ingress:
    enabled: true
    ingressClassName: traefik
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      traefik.ingress.kubernetes.io/router.entrypoints: "web,websecure"
      traefik.ingress.kubernetes.io/router.tls: "true"
    hosts:
      - auth.cubancodelab.net
    paths:
      - /
    pathType: Prefix
    tls:
      - secretName: authentik-tls
        hosts:
          - auth.cubancodelab.net

  # Resources for authentik server
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi

worker:
  envFrom:
  - secretRef:
      name: authentik

# PostgreSQL configuration
postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnami/postgresql
    tag: latest
  auth:
    username: authentik
    database: authentik
    existingSecret: authentik
    secretKeys:
      adminPasswordKey: postgresql-password
      userPasswordKey: postgresql-password
      replicationPasswordKey: postgresql-replication-password
  primary:
    persistence:
      enabled: true
      size: 8Gi

redis:
  enabled: true
  auth:
    enabled: true
    existingSecret: authentik
    existingSecretPasswordKey: redis-password
  master:
    persistence:
      enabled: true
      size: 8Gi
    image:
      registry: docker.io
      repository: bitnami/redis
      tag: latest